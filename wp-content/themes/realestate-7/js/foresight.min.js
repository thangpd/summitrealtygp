(function(a,b,c,d){"use strict";a.devicePixelRatio=b.devicePixelRatio&&b.devicePixelRatio>1?b.devicePixelRatio:1;a.isHighSpeedConn=false;a.hiResEnabled=false;a.connKbps;a.connTestResult;a.connType;a.images=[];a.options=a.options||{};var e=a.options,f=e.srcModification||"replaceDimensions",g=e.srcUriTemplate||"{protocol}://{host}{directory}{file}",h=e.testConn||true,i=e.minKbpsForHighSpeedConn||400,j=e.speedTestUri||"http://foresightjs.appspot.com/speed-test/50K.jpg",k=e.speedTestKB||50,l=e.speedTestExpireMinutes||30,m=e.maxBrowserWidth||1024,n=e.maxBrowserHeight||m,o=e.maxRequestWidth||2048,p=e.maxRequestHeight||o,q=e.forcedPixelRatio,r,s,t="loading",u="complete",v="fsjs",w=true,x=false,y=function(){if(r)return;r=t;z();r=u;B()},z=function(){var b,d;for(b=0;b<c.images.length;b++){d=c.images[b];if(!d.initalized){d.initalized=w;A(d,"src","orgSrc");A(d,"width","browserWidth");A(d,"height","browserHeight");if(!d.orgSrc||!d.browserWidth||!d.browserHeight)continue;d.orgWidth=d.browserWidth;d.orgHeight=d.browserHeight;d.requestWidth=0;d.requestHeight=0;d.orgClassName=d.className.replace("fs-img","fs-img-ready");A(d,"max-width","maxWidth",w,m);A(d,"max-height","maxHeight",w,n);A(d,"max-request-width","maxRequestWidth",w,o);A(d,"max-request-height","maxRequestHeight",w,p);A(d,"width-percent","widthPercent",w,0);A(d,"height-percent","heightPercent",w,0);A(d,"src-modification","srcModification",x,f);A(d,"src-uri-template","srcUriTemplate",x,g);A(d,"pixel-ratio","pixelRatio",w,a.devicePixelRatio);A(d,"src-high-resolution","highResolution",x);a.images.push(d)}}},A=function(a,b,c,d,e){var f=a.getAttribute("data-"+b);if(f&&f!==""){if(d&&!isNaN(f)){f=parseFloat(f,10)}}else{f=e}a[c]=f},B=function(){if(s===u&&r===u){if(a.isHighSpeedConn&&a.devicePixelRatio>1){a.hiResEnabled=w}var b,c,d,e,f;for(b=0;b<a.images.length;b++){c=a.images[b];c.hiResEnabled=a.isHighSpeedConn&&c.pixelRatio>1;c.parentWidth=C(c,"clientWidth");c.parentHeight=C(c,"clientHeight");if(c.widthPercent){if(!c.parentWidth)continue;var g=c.browserWidth;c.browserWidth=J(c.widthPercent/100*c.parentWidth);c.browserHeight=J(c.browserHeight*(c.browserWidth/g))}else if(c.heightPercent){if(!clientHeight)continue;var h=c.browserHeight;c.browserHeight=J(c.heightPercent/100*c.parentHeight);c.browserWidth=J(c.browserWidth*(c.browserHeight/h))}D(c,"browserWidth","maxWidth","browserHeight","maxHeight");if(!c.browserWidth||!c.browserHeight){continue}var i=c.orgClassName?c.orgClassName.split(" "):[];i.push(c.hiResEnabled?"fs-high-resolution":"fs-standard-resolution");i.push("fs-pixel-ratio-"+c.pixelRatio.toFixed(1).replace(".","_"));c.className=i.join(" ");if(c.hiResEnabled){d=J(c.browserWidth*c.pixelRatio);e=J(c.browserHeight*c.pixelRatio)}else{d=c.browserWidth;e=c.browserHeight}f=x;if(d>c.requestWidth){c.requestWidth=d;f=w}if(e>c.requestHeight){c.requestHeight=e;f=w}if(f){D(c,"requestWidth","maxRequestWidth","requestHeight","maxRequestHeight");if(c.highResolution&&a.hiResEnabled){c.src=c.highResolution;c.srcModification="hiResSrc"}else if(c.srcModification==="rebuildSrc"&&c.srcUriTemplate){E(c)}else{G(c)}}c.width=c.browserWidth;c.height=c.browserHeight}if(a.updateComplete){a.updateComplete()}}},C=function(a,b){var c=a.parentElement;if(c){if(c[b]){return c[b]}else{return C(c,b)}}return 0},D=function(a,b,c,d,e){var f;if(a[b]>a[c]){f=a[b];a[b]=a[c];a[d]=J(a[d]*(a[b]/f))}if(a[d]>a[e]){f=a[d];a[d]=a[e];a[b]=J(a[b]*(a[d]/f));if(a[b]>a[c]){f=a.img[b];a[b]=a[c];a[d]=J(a[d]*(a[b]/f))}}},E=function(a){var b,c=["protocol","host","port","directory","file","filename","ext","query","requestWidth","requestHeight","pixelRatio"],d=a.srcUriTemplate;a.uri=F(a.orgSrc);a.uri.requestWidth=a.requestWidth;a.uri.requestHeight=a.requestHeight;a.uri.pixelRatio=a.pixelRatio;for(b=0;b<c.length;b++){d=d.replace("{"+c[b]+"}",a.uri[c[b]])}a.src=d},F=function(a){var b={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},c=b.parser.exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";d[b.q.name]={};d[b.key[12]].replace(b.q.parser,function(a,c,e){if(c)d[b.q.name][c]=e});var f=d.file.split(".");d.filename=f[0];d.ext=f.length>1?f[f.length-1]:"";return d},G=function(a){a.src=a.orgSrc.replace(a.orgWidth,a.requestWidth).replace(a.orgHeight,a.requestHeight)},H=function(){if(s)return;if(a.devicePixelRatio===1){a.connTestResult="skip";s=u;return}a.connType=d.connection&&d.connection.type?d.connection.type.toString().toLowerCase():"unknown";if(a.connType!=="unknown"){var b,e=["2g","3g"];for(b=0;b<e.length;b++){if(a.connType.indexOf(e[b])>-1){a.connTestResult="connTypeSlow";s=u;return}}}try{var f=JSON.parse(localStorage.getItem(v));if(f!==null){var g=((new Date).getTime()-f.timestamp)/1e3/60;if(g<l){a.isHighSpeedConn=f.isHighSpeedConn;a.connKbps=f.connKbps;a.connTestResult="localStorage";s=u;return}}}catch(h){}var m=c.createElement("img"),n,o,p;m.onload=function(){n=(new Date).getTime();var b=J((n-o)/1e3);b=b>1?b:1;var c=k*1024*8;a.connKbps=J(c/b)/1024;a.isHighSpeedConn=a.connKbps>=i;I("networkSuccess")};m.onerror=function(){I("networkError")};o=(new Date).getTime();s=t;if(c.location.protocol==="https:"){j=j.replace("http:","https:")}m.src=j+"?r="+Math.random();p=k*8/i*1e3+350;setTimeout(function(){I("networkSlow")},p)},I=function(b){if(s===u)return;s=u;a.connTestResult=b;try{var c={connKbps:a.connKbps,isHighSpeedConn:a.isHighSpeedConn,timestamp:(new Date).getTime()};localStorage.setItem(v,JSON.stringify(c))}catch(d){}B()},J=function(a){return Math.round(a)},K=function(){if(b.addEventListener){b.addEventListener("resize",a.reload,x)}else if(b.attachEvent){b.attachEvent("onresize",a.reload)}},L,M=function(){if(r!==u||s!==u)return;z();B()};a.reload=function(){b.clearTimeout(L);L=b.setTimeout(M,100)};if(q){a.devicePixelRatio=q}if(c.readyState===u){y()}else{if(c.addEventListener){c.addEventListener("DOMContentLoaded",y,x);b.addEventListener("load",y,x)}else if(c.attachEvent){c.attachEvent("onreadystatechange",y);b.attachEvent("onload",y)}}H();K()})(this.foresight=this.foresight||{},this,document,navigator)